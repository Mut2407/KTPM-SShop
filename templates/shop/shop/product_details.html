{% extends '../../base.html' %}
{% load static %}

{% block title %}
    {{ single_product.name }}
{% endblock title %}

{% block content %}

<!-- Page Title -->
<div style="background: #40394a" class="pages-title section-padding">
    <div class="container">
        <div class="row">
            <div class="col-xs-12">
                <div class="pages-title-text text-center">
                    <h2 style="color: #f4cca4">{{ single_product.name }}</h2>
                    <ul class="text-left">
                        <li><a style="color: #d99879" href="/">Home</a></li>
                        <li style="color: #d99879"><span> // </span><a style="color: #d99879" href="{% url 'shop:shop' %}">Shop</a></li>
                        <li style="color: #d99879"><span> // </span>{{ single_product.category }}</li>
                        <li style="color: #d99879"><span> // </span>{{ single_product.name }}</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Product Detail Section -->
<div style="background: #1c1427" class="product-details pages section-padding-top">
    <div class="container">
        <div class="row">
            <div style="font-size: 18px">

                {% include "includes/alerts.html" %}

                <div class="single-list-view">
                    <div class="col-xs-12 col-sm-5 col-md-4">

                        <!-- Product Image -->
                        <div class="quick-image">
                            <div class="single-quick-image text-center">
                                <div class="list-img">
                                    <div class="product-img tab-content">
                                        <div class="simpleLens-container tab-pane active fade in mainImage">
                                            <a class="simpleLens-image" data-lens-image="{{ single_product.image.url }}" href="#">
                                                <img style="border-radius: 10px"
                                                    src="{{ single_product.image.url }}"
                                                    alt=""
                                                    class="simpleLens-big-image">
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Thumbnail -->
                            <div class="quick-thumb">
                                <ul class="product-slider thumb">
                                    <li>
                                        <a href="{{ single_product.image.url }}"
                                           data-lens-image="{{ single_product.image.url }}"
                                           target="mainImage">
                                            <img style="width: 85px; height: 100px; border-radius: 10px"
                                                 src="{{ single_product.image.url }}"
                                                 alt="quick view">
                                        </a>
                                    </li>

                                    {% for i in product_gallery %}
                                    <li>
                                        <a href="{{ i.image.url }}"
                                           data-lens-image="{{ i.image.url }}"
                                           target="mainImage">
                                            <img style="width: 85px; height: 100px; border-radius: 10px"
                                                 src="{{ i.image.url }}"
                                                 alt="quick view">
                                        </a>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>

                        </div>
                    </div>

                    <!-- Product Info -->
                    <div class="col-xs-12 col-sm-7 col-md-8">
                        <div class="quick-right">
                            <div style="border-radius: 10px" class="list-text">

                                <h3 style="color: #d99879">
                                    {{ single_product.name }}

                                    {% if single_product.stock == 0 %}
                                    <span style="
                                        font-size: 14px;
                                        background-color: #d9534f;
                                        color: white;
                                        padding: 5px 10px;
                                        border-radius: 5px;">
                                        Hết hàng
                                    </span>
                                    {% endif %}
                                </h3>

                                <h5>
                                    {% if single_product.discount != 0.00 %}
                                        <del>${{ single_product.discount }}</del>
                                    {% endif %}

                                    <div class="ratting floatright">
                                        <p style="font-size: 1.5rem">( {{ single_product.countReview }} Rating )</p>

                                        <div class="rating-star" style="float: right; font-size: 1.5rem">
                                            <span>
                                                <i class="fa fa-star{% if single_product.averageRating < 0.5 %}-o
                                                    {% elif single_product.averageRating < 1 %}-half-o{% endif %}">
                                                </i>
                                                <i class="fa fa-star{% if single_product.averageRating < 1.5 %}-o
                                                    {% elif single_product.averageRating < 2 %}-half-o{% endif %}">
                                                </i>
                                                <i class="fa fa-star{% if single_product.averageRating < 2.5 %}-o
                                                    {% elif single_product.averageRating < 3 %}-half-o{% endif %}">
                                                </i>
                                                <i class="fa fa-star{% if single_product.averageRating < 3.5 %}-o
                                                    {% elif single_product.averageRating < 4 %}-half-o{% endif %}">
                                                </i>
                                                <i class="fa fa-star{% if single_product.averageRating < 4.5 %}-o
                                                    {% elif single_product.averageRating < 5 %}-half-o{% endif %}">
                                                </i>
                                            </span>
                                        </div>
                                    </div>

                                    ${{ single_product.price }}
                                </h5>

                                <p>{{ single_product.description }}</p>

                                <!-- Add to Cart -->
                                <form action="{% url 'cart:add_cart' single_product.id %}" method="POST">
                                    {% csrf_token %}

                                    <div class="all-choose">

                                        {% if single_product.variation_set.colors %}
                                        <div class="col-xs-12 col-sm-7 col-md-5 s-shoose" style="margin-right: 40px">
                                            <p style="font-size: 20px; margin-bottom: 5px">Color</p>

                                            <select name="color" class="form-control" required>
                                                <option value="" disabled selected>Select</option>

                                                {% for x in single_product.variation_set.colors %}
                                                    <option value="{{ x.variation_value|lower }}">{{ x.variation_value|capfirst }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        {% endif %}

                                        {% if single_product.variation_set.sizes %}
                                        <div class="col-xs-12 col-sm-7 col-md-5 s-shoose ml-3">
                                            <p style="font-size: 20px; margin-bottom: 5px">Size</p>

                                            <select name="size" class="form-control" required>
                                                <option value="" disabled selected>Select</option>

                                                {% for x in single_product.variation_set.sizes %}
                                                    <option value="{{ x.variation_value|lower }}">{{ x.variation_value|capfirst }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        {% endif %}

                                        <br><br><br><br>

                                        <div class="s-shoose">
                                            <br>

                                            {% if single_product.stock <= 0 %}
                                            <div class="alert alert-danger text-center"
                                                style="font-size: 18px; background-color: #ffcccc; color: #cc0000; border: 1px solid #cc0000;">
                                                <b><i class="fa fa-exclamation-triangle"></i> Sản phẩm đã hết hàng</b>
                                            </div>

                                            <script>
                                                document.addEventListener("DOMContentLoaded", function () {
                                                    document.querySelectorAll(".s-shoose select").forEach(function (select) {
                                                        select.disabled = true;
                                                    });
                                                });
                                            </script>

                                            {% else %}
                                            <div class="list-btn floatright">
                                                <button type="submit" class="btn"
                                                    style="background: #f4cca4; color: #1c1427; font-size: 18px;">
                                                    <b>Add to cart <i class="mdi mdi-cart-outline"></i></b>
                                                </button>
                                            </div>
                                            {% endif %}

                                            <br>
                                        </div>

                                    </div>
                                </form>

                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reviews -->
                <div class="row">
                    <div class="col-xs-12">
                        <div class="reviews padding60 margin-top" style="border-radius: 10px">
                            <ul class="reviews-tab clearfix">
                                <li class="active">
                                    <a style="font-size: 25px; color: #d99879" data-toggle="tab" href="#reviews">
                                        Rate and review
                                    </a>
                                </li>
                            </ul>

                            <div class="tab-content">
                                <div id="reviews" class="info-reviews review-text tab-pane fade in active">

                                    <!-- Review Form -->
                                    <form action="{% url 'shop:review' single_product.id %}" method="POST">
                                        {% csrf_token %}

                                        <div class="your-rating log-title">
                                            <h5>Product rating</h5>

                                            <div class="rate">
                                                {% for val in "10,9,8,7,6,5,4,3,2,1"|cut:"," %}
                                                    <input type="radio" name="rating" id="rating{{ val }}"
                                                          value="{{ val|float|div:2 }}" required>
                                                    <label for="rating{{ val }}"
                                                          {% if val|float % 2 != 0 %}class="half"{% endif %}></label>
                                                {% endfor %}
                                            </div>

                                        </div>

                                        <br>

                                        <div class="custom-input">
                                            <div class="row">
                                                <div class="col-xs-12">
                                                    <textarea name="review"
                                                        style="border: 2px solid #f4cca4"
                                                        class="form-control"
                                                        placeholder="Review..."
                                                        rows="2"></textarea>
                                                </div>

                                                <div class="col-xs-12">
                                                    <br>

                                                    <div class="submit-text">

                                                        {% if user.is_authenticated %}
                                                            {% if orderproduct %}
                                                                <button type="submit" class="btn btn-warning"
                                                                    style="background: #f4cca4; color: #1c1427; font-size: 18px; float: right;">
                                                                    <b>Submit review</b>
                                                                </button>
                                                            {% else %}
                                                                <div class="container alert alert-info text-center"
                                                                     style="font-size: 18px; margin-top: 10px; width: 75%;">
                                                                    You must buy this product to review on it!
                                                                </div>
                                                            {% endif %}
                                                        {% else %}
                                                            <div class="container alert alert-info text-center"
                                                                 style="font-size: 18px; margin-top: 10px; width: 75%;">
                                                                You must login to rate and review,
                                                                <a href="{% url 'accounts:login' %}"
                                                                    style="background: none; color: #000;">
                                                                    Login
                                                                </a>
                                                            </div>
                                                        {% endif %}

                                                    </div>

                                                </div>
                                            </div>
                                        </div>

                                    </form>

                                    <br><br><hr>

                                    <!-- Review List -->
                                    <div class="about-author">
                                        <h3 class="text-center" style="color: #d99879">Customer rating</h3>
                                        <br>

                                        {% if reviews %}
                                            {% for review in reviews %}
                                            <div class="autohr-text"
                                                 style="background: #1c1427; padding: 20px; border-radius: 15px">

                                                <img src="{{ review.user.userprofile.profile_picture.url }}"
                                                     style="width: 50px; height: 50px; border-radius: 50%"
                                                     class="img-xs icon rounded-circle">

                                                <div class="author-des">

                                                    <span style="color: #f4cca4; float: right; font-size: 14px">
                                                        {{ review.update_at }}
                                                    </span>

                                                    <h4 style="color: #d99879">{{ review.user.full_name }}</h4>

                                                    <div class="rating-star">
                                                        <span>
                                                            {% for i in "1 2 3 4 5".split %}
                                                                <i class="fa fa-star{% if review.rating < i|float - 0.5 %}-o
                                                                    {% elif review.rating < i|float %}-half-o{% endif %}">
                                                                </i>
                                                            {% endfor %}
                                                        </span>
                                                    </div>

                                                    <p style="font-size: 18px; margin-top: 15px">
                                                        {{ review.review }}
                                                    </p>
                                                </div>

                                            </div>

                                            <hr>
                                            {% endfor %}

                                        {% else %}
                                            <br>
                                            <div class="alert alert-info text-center" style="font-size: 16px">
                                                Be First Reviewer!
                                            </div>
                                        {% endif %}

                                    </div>

                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
        </div>

        <br>

    </div>
</div>

{% endblock %}
